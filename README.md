#  Highly Adaptive Regression Trees

Highly Adaptive Regression Trees (HART) is a method for mapping Highly Adaptive Lasso (HAL) model fits to decision trees. The files in this repository allow for reproduction of results shown in our paper submitted to NeurIPS 2021 as well as general experimentation with HAL and HART. Code was written in R version 4.0.3 (distributed under the terms of the GNU General Public License version 3) and Python version 3.7 (distributed under the terms of the PSF license agreement). There are 3 main things to explore/reproduce in this code. Below are descriptions of these tasks and how to perform them using the code and data stored in this repository. Before beginning, download the entire repository, preserve the file structure, and set this as your working directory.

# 0. Code description

- HAL.R takes the name of a dataset (cpu, fev, or mussels), builds HAL models for that dataset under many random seeds, calculates the cv-R^2 value for each model and writes these to a csv file, and writes csv files containing the information that HART.py needs to build HARTs for each HAL model. HAL.R automatically uses the random seeds in the csv file corresponding to each dataset in the ./seeds/ directory to build the models. E.g. fev_seeds is a csv file with one column containing the random seeds used for fev in the paper submission. One could modify the files in the ./seeds/ directory to rerun these experiments with new random seeds.

- l1_experiments.R takes the name of a dataset (cpu, fev, or mussels), builds HAL models under a variety of l1 penalization terms (pre-specified by the hal9001 package), writes a csv file containing the cv-R^2 value for models corresponding to each penalty term, and writes csv files containing the information that HART.py needs to build HARTs for each HAL model.

- HART.py builds and evaluates HARTs based on data generated either by HAL.R or l1_experiments.R. HART.py takes in the name of a dataset, a boolean named l1 (1 if results are from l1_experiments.R and 0 if from HAL.R), and the number of HAL models that have been generated.

- l1_performance_plot.R takes the files generated by l1_experiments.R and HART.py to create figures showing the relationship between cv-R2 and terminal node count with respect to many different l1 penalty terms. 

- non_HAL.R takes the name of a dataset and the name of an algorithm (rpart or randomForest), builds models using the seeds provided in the corresponding csv file in ./seeds/, and writes a csv file containing cv-R^2 values for each model built. 

- Results can be generated automatically by using the scripts eval_hart.sh, l1_fig.sh, and eval_other.sh per the instructions below.


# 1. HART Size and Performance (Table 1 from paper submission)

- Goal: Evaluate the size (in terms of terminal node and unique terminal node counts) and performance (in terms of cross-validated R^2) of HARTs mapped from HAL model fits built using many random seeds on a user-chosen dataset.

- Packages/libraries required: hal9001 (R Library), anytree (Python Library), pandas (Python Library), random (Python Library), sys (Python Library). See requirements.txt for instructions on installing these libraries.

- Instructions: To reproduce results from the Table 1 of the paper submission, run the following commands at the command line from the current directory:

```
$./eval_hart.sh 0 cpu 10

$./eval_hart.sh 0 fev 100

$./eval_hart.sh 0 mussels 100
```

The result will be 3 csv files named cpu_hart_eval.csv, fev_hart_eval.csv, and mussels_hart_eval.csv, each with 3 columns: R^2, Terminal Node Count, Unique Terminal Node count. The number of rows will correspond to the third argument in each command above (equal to the number of random seeds used to fit HAL for each dataset). These files can be analyzed for mean and sd of terminal node count, unique terminal node count, and R^2 value. 

# 2. HART Size and Performance With Heavy L1 Penalization

- Goal:
- Packages/libraries required:
- Instructions:

```

```

# 3. Performance of Other Algorithms (randomForest and CART/rpart)

- Goal:
- Packages/libraries required:
- Instructions:

```

```

